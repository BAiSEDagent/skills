# x402: HTTP 402 Micropayment Protocol

## Overview
x402 resurrects the HTTP 402 Payment Required status code for crypto micropayments. Servers request payment via 402 response; clients pay using onchain stablecoins (USDC); access is granted. Frictionless for both humans and AI agents.

## Payment Flow
1. **Client request:** `GET /data` -> normal HTTP request
2. **402 Response:** Server returns `HTTP/1.1 402 Payment Required` with `PAYMENT-REQUIRED` header
3. **Payment selection:** Client decodes header, chooses payment option, constructs `PaymentPayload`
4. **Payment submission:** Client re-sends original request with `PAYMENT-SIGNATURE` header
5. **Settlement:** Server verifies via facilitator contract, settles payment, returns content with `PAYMENT-RESPONSE` header

## Protocol Headers
### PAYMENT-REQUIRED (server -> client)
Base64-encoded JSON:
- `amount` -- payment amount
- `currency` -- token address
- `acceptedMethods` -- e.g., `["erc3009", "permit2"]`
- `expiry` -- payment deadline
- `paymentId` -- opaque identifier
- `paymentPurpose` -- human-readable description (optional)

### PAYMENT-SIGNATURE (client -> server)
Base64-encoded PaymentPayload:
- `amount`, `asset` (ERC-20 address), `payTo` (merchant address)
- `maxTimeoutSeconds`, `signature`
- EIP-3009 authorization: `from`, `to`, `value`, `validAfter`, `validBefore`, `nonce`, `signature`

### PAYMENT-RESPONSE (server -> client)
Settlement proof -- transaction hash or facilitator receipt.

## Payment Mechanisms
- **EIP-3009** (`transferWithAuthorization`) -- gasless token transfers, primary method
- **Permit2** -- alternative authorization scheme

## Client Libraries
- JavaScript: `@x402/fetch`, `@x402/evm`
- Python: `x402`
- Go: `x402` package

## JavaScript Example
```javascript
import { x402fetch } from '@x402/fetch';
import { createEVMClient } from '@x402/evm';
import { createWalletClient, privateKeyToAccount } from 'viem';

const account = privateKeyToAccount('0xPRIVATE_KEY');
const evmClient = createEVMClient({ chainId: 8453, account });
const response = await x402fetch('https://api.example.com/data', {
  method: 'GET',
  evmClient,
  fetchOptions: {}
});
const data = await response.json();
```

## Server Setup
Add one-line `paymentMiddleware` to Node/Go/Python server. Middleware:
- Checks for `PAYMENT-SIGNATURE` header
- If absent -> responds with 402 + `PAYMENT-REQUIRED`
- If present -> verifies via facilitator contract, settles payment

## Base Facilitator Contract
Treasure x402 facilitator (mainnet + Sepolia):
- Verifies EIP-3009 authorizations
- Executes token transfers
- Prevents double-spend

## Supported Currencies (Base)
USDC, MAGIC, SMOL, MIO, AI Frens tokens. DAI/USDT planned.

## Live Adopters
1Pay.ing, Bino, Ekai Labs, Genbase, Kodo, Nuwa, Oops!402, Primer, PayStabl

## BAiSED Implementation Plan
1. Integrate x402 client libraries for automatic 402 handling
2. Configure EVM signer with BAiSED's smart wallet for USDC payments
3. For server components: add payment middleware, register with Base facilitator
4. Publish x402 endpoints in ERC-8004 registration file
5. Design pricing aligned with compute costs and insight value